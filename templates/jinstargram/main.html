<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    {% load static %}
    <title>Djongo_insta</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"/>
    <link href="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Two+Tone|Material+Icons+Round|Material+Icons+Sharp"
          rel="stylesheet">
    {# 제이쿼리 링크#}
    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
    <style>
        .rounded-circle {
            object-fit: cover;
            width: 50px;
            height: 50px;
            left: 0px;

        }

        input:focus {
            outline: none;
            border: none
        }

        .right .rounded-circle {
            object-fit: cover;
            width: 80px;
            height: 80px;
            left: 0px;
        }

        .rounded-rec {
            object-fit: cover;
            width: 50px;
            height: 50px;
            left: 0px;
            margin-top: 5px;
            border-radius: 50%;
        }

        .modal_overlay {
            width: 100%;
            height: 100%;
            position: absolute;
            left: 0;
            top: 0;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(1.5px);
            -webkit-backdrop-filter: blur(1.5px);
        }

        .modal_window {
            background: white;
            backdrop-filter: blur(13.5px);
            -webkit-backdrop-filter: blur(13.5px);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            width: 800px;
            height: 600px;
            position: relative;
            padding: 10px;
        }

        #nav_bar_add_box {
            cursor: pointer;
        }

        hr {
            width: 80%;
            margin-left: auto;
            margin-right: auto;
        }

    </style>
</head>
<body>
<nav style="height: 60px; position: fixed; width: 100%; align-items: center;"
     class="navbar navbar-expand-lg bg-body-tertiary">
    <div class="container-fluid"
         style=" display:flex; justify-content: space-around; flex-wrap: nowrap; min-width: 1000px">
        <a class="navbar-brand" href="#"><img style="box-sizing: border-box;height: 100%; width: 110px"
                                              src="https://logos-world.net/wp-content/uploads/2020/04/Instagram-Logo-2010-2013.png"></a>

        <input style="height: 40px;width: 250px; border:1px solid rgb(153,153,153); background-color:rgb(234,234,234) ; text-align: center"
               class="form-control me-2" type="search" placeholder="검색" aria-label="Search">
        <div style="display: flex; align-items: center; justify-content: space-between; width: 200px">
            <span class="material-symbols-outlined">
                home
            </span>
            <span class="material-symbols-outlined">
                send
            </span>

            <span id="nav_bar_add_box" class="material-symbols-outlined">
                add_box
            </span>
            <span class="material-symbols-outlined">
                explore
            </span>
            <span class="material-symbols-outlined">
                favorite
            </span>
        </div>
    </div>

</nav>
{#피드 데이터#}
<div style="display: flex; flex-direction: row;  justify-content: center; padding-top: 120px; background-color: #f5f1f1; height: 2500px">
    {#        피드박스#}

    <div style="width: 650px; height:1000px  ; margin-right: 15.5%; " class="left_content">
        <div style="display: flex; flex-direction: column">
            {% for feed in feeds %}


                <div style="border: 1px solid grey; background-color: #fafafa; padding: 18px ">
                    <div style="display: flex; flex-direction: row; align-items: center;">
                        <img src="{{ feed.profile_image }}"
                             class="rounded-circle" alt="프사">
                        <div style="margin-left: 5px">{{ feed.user_id }}</div>
                    </div>
                    <div style="height: 300px"><img style="width: 100% ; height: 100%; object-fit: cover;"
                              src="{% get_media_prefix %}{{ feed.image }}"></div>
                    <div style="display: flex; flex-direction: row; justify-content: space-between; margin-top: 10px">
                        <div>
                            <span class="material-symbols-outlined">favorite</span>
                            <span class="material-symbols-outlined">
chat_bubble
</span>
                            <span class="material-symbols-outlined">
send
</span>
                        </div>
                        <div>
                            <div><span class="material-symbols-outlined">bookmark</span></div>
                        </div>
                    </div>
                    <div>죠르디 <b>외 {{ feed.like_count }}명</b>이 좋아합니다.</div>
                    <div><b>{{ feed.user_id }}</b> {{ feed.content }}</div>
                    <div style="font-size: 15px"><b>춘식이</b> 저기가 어디??</div>
                    <div style="font-size: 15px"><b>콘</b> 나도 가고 싶어요ㅠㅠㅠ</div>
                    <hr/>
                    <div style="margin-top: 10px"><input style="box-shadow: none;" type="text" class="form-control"
                                                         id="exampleFormControlInput1" placeholder="댓글 달기..."></div>
                </div>

                <br/>
                <br/>


            {% endfor %}
        </div>
    </div>
    {#    피드박스 끝#}
    <div style="width: 400px; height:1000px;  position: fixed; left: 65%;">
        <div style="display: flex; flex-direction: row; justify-content: space-between">
            <div class="right" style="display: flex; flex-direction: row">
                <img src="https://item.kakaocdn.net/do/d0f10bc52c1b988e9a6e224b1c02bd499f5287469802eca457586a25a096fd31"
                     class="rounded-circle" alt="프사">
                <div style="margin:10px 10px">
                    <div style="margin-left: 5px; font-weight: bold">죠르죠르디</div>
                    <div style="margin-left: 5px; font-size: 13px ">카카오 죠르디</div>
                </div>
            </div>
            <div style="justify-content: right; margin:15px 10px; color: dodgerblue ; font-weight: bold;font-size: 13px;">
                전환
            </div>
        </div>
        <div style="display: flex; flex-direction: row; justify-content: space-between; margin: 13px 0;">
            <div style="font-weight: bold; color: gray;">회원님을 위한 추천</div>
            <div><a style="text-decoration: none; color: black; font-weight: bold;font-size: 13px" href="#">모두보기</a>
            </div>
        </div>

        <div style="display: flex; flex-direction: column">

            <div style="display: flex; flex-direction: row; justify-content: space-between; margin-left: 5px">
                <div class="right" style="display: flex; flex-direction: row">
                    <img src="https://i.namu.wiki/i/IUKpnzynPCMlkcs4qRLos3NAnwQu48KLCi7eUXFK0RDyRO1o4rgquRpH2iEJh6G4CGkiGglBWuDp04zsc4Cwww.webp"
                         class="rounded-rec" alt="프사">
                    <div style="margin:10px 10px">
                        <div style="margin-left: 5px; font-weight: bold; font-size: 15px">춘식춘식이</div>
                        <div style="margin-left: 5px; font-size: 13px ">춘식님 외 31명이 팔로우 합니다</div>
                    </div>
                </div>
                <div style="justify-content: right; margin:15px 10px; color: dodgerblue ; font-weight: bold;font-size: 13px;">
                    팔로우
                </div>
            </div>

            <div style="display: flex; flex-direction: row; justify-content: space-between; margin-left: 5px">
                <div class="right" style="display: flex; flex-direction: row">
                    <img src="https://pbs.twimg.com/media/FEh5WX6aQAAXrlg.jpg"
                         class="rounded-rec" alt="프사">
                    <div style="margin:10px 10px">
                        <div style="margin-left: 5px; font-weight: bold; font-size: 15px">앙몬앙몬드</div>
                        <div style="margin-left: 5px; font-size: 13px ">앙몬님 외 31명이 팔로우 합니다</div>
                    </div>
                </div>
                <div style="justify-content: right; margin:15px 10px; color: dodgerblue ; font-weight: bold;font-size: 13px;">
                    팔로우
                </div>
            </div>
            <div style="display: flex; flex-direction: row; justify-content: space-between; margin-left: 5px">
                <div class="right" style="display: flex; flex-direction: row">
                    <img src="https://t1.daumcdn.net/cfile/tistory/99BC7C355F8710892B"
                         class="rounded-rec" alt="프사">
                    <div style="margin:10px 10px">
                        <div style="margin-left: 5px; font-weight: bold; font-size: 15px">콘콘</div>
                        <div style="margin-left: 5px; font-size: 13px ">콘님 외 31명이 팔로우 합니다</div>
                    </div>
                </div>
                <div style="justify-content: right; margin:15px 10px; color: dodgerblue ; font-weight: bold;font-size: 13px;">
                    팔로우
                </div>
            </div>
            <div style="display: flex; flex-direction: row; justify-content: space-between; margin-left: 5px">
                <div class="right" style="display: flex; flex-direction: row">
                    <img src="https://item.kakaocdn.net/do/69cebc0bb0fde90622919a2e663add367154249a3890514a43687a85e6b6cc82"
                         class="rounded-rec" alt="프사">
                    <div style="margin:10px 10px">
                        <div style="margin-left: 5px; font-weight: bold; font-size: 15px">어피치어피</div>
                        <div style="margin-left: 5px; font-size: 13px ">어피치님 외 31명이 팔로우 합니다</div>
                    </div>
                </div>
                <div style="justify-content: right; margin:15px 10px; color: dodgerblue ; font-weight: bold;font-size: 13px;">
                    팔로우
                </div>
            </div>
            <div style="display: flex; flex-direction: row; justify-content: space-between; margin-left: 5px">
                <div class="right" style="display: flex; flex-direction: row">
                    <img src="https://newsimg.sedaily.com/2019/01/23/1VE5F3W5WP_18.png"
                         class="rounded-rec" alt="프사">
                    <div style="margin:10px 10px">
                        <div style="margin-left: 5px; font-weight: bold; font-size: 15px">라이언리아</div>
                        <div style="margin-left: 5px; font-size: 13px ">라이언님 외 31명이 팔로우 합니다</div>
                    </div>
                </div>
                <div style="justify-content: right; margin:15px 10px; color: dodgerblue ; font-weight: bold;font-size: 13px;">
                    팔로우
                </div>
            </div>
        </div>
    </div>
</div>
{#모달 창 만들기 시작#}
{#    첫번째 모달 #}
<div id="first_modal" class="modal_overlay">
    <div class="modal_window">
        <div style="display: flex; flex-direction: row; justify-content: space-between">
            <div style="width: 20px">
            </div>
            <div>
                <div style="font-weight: bold; font-size: 20px"> 새 이미지 업로드</div>
            </div>
            <div style="width: 20px; font-size: 17px">
                X
            </div>
        </div>
        <hr/>
        <div class="img_upload_space" style="margin: 30px auto; width: 700px; height: 485px; ">

        </div>
    </div>
</div>
{#두번쨰 모달#}
<div id="second_modal" class="modal_overlay">
    <div class="modal_window">
        <div style=" display: flex; flex-direction: row; justify-content: space-between">
            <div style="width: 20px">
            </div>
            <div>
                <div style="font-weight: bold; font-size: 20px"> 새 이미지 업로드</div>
            </div>
            <div style="width: 20px; font-size: 17px">
                X
            </div>
        </div>
        <hr/>
        <div style="display: flex; flex-direction: row">

            <div class="img_upload_space" style="margin: auto; width: 500px; height: 500px; ">

            </div>
            <div style="border-left: 1px solid gray; padding-left: 20px ; width: 260px">
                <div style=" margin-right: 30px">
                    <textarea id="input_feed_content" style="width: 235px; height: 400px" class="form-control" id="exampleFormControlTextarea1" rows="3"></textarea>
                </div>
                <button id="feed_create_button" type="button" class="btn btn-primary" style="width: 100%">공유하기</button>

            </div>
        </div>
    </div>
</div>
{#모달 창 만들기 끝#}
{#자바스크립트(제이쿼리)#}
<script>

    let files;

    $('#nav_bar_add_box').click(function () {
        $('#first_modal').css({
            display: 'flex',
        });
        $(document.body).css({
            overflow: 'hidden'
        })
    });

    $('#feed_create_button').click(function (){
        alert("공유하기 눌렀다.")
    {#    서버 호출   #}
        let file = files[0];
        let image = files[0].name;
        let content = $('#input_feed_content').val();
        let user_id = '죠르죠르디';
        let profile_image = "https://item.kakaocdn.net/do/d0f10bc52c1b988e9a6e224b1c02bd499f5287469802eca457586a25a096fd31";
        {#파일 업로드 위해 form data 형식#}
        let fd = new FormData();
        fd.append('file', file);
        fd.append('image',image)
        fd.append('content',content)
        fd.append('user_id',user_id)
        fd.append('profile_image',profile_image)

        {#비동기 위해 ajax#}
{#        ajax는 폼 데이터를 날리는데 성공하면 성공, 실패하면 에러가 #}
        $.ajax({
            url: "/content/upload/",
            data: fd,
            method : "POST",
            processData: false,
            contentType: false,
            success: function (data) {
                console.log('성공')
            },
            error : function(request, status, error) {
                console.log('에러')
            },
            complete: function (){
                console.log("완료")
                location.replace("/main")
            }
        })
    })

    $('.img_upload_space')
        .on("dragover", dragOver)
        .on("dragleave", dragOver)
        .on("drop", uploadFiles);

    function dragOver(e) {
        e.stopPropagation();
        e.preventDefault();

        if (e.type == "dragover") {
            $(e.target).css({
                "background-color": "black",
                "outline-offset": "-20px"
            });
        } else {
            $(e.target).css({
                "outline-offset": "-10px"
            });
        }
    }

    function uploadFiles(e) {
        e.stopPropagation();
        e.preventDefault();


        e.dataTransfer = e.originalEvent.dataTransfer; //2
        files = e.target.files || e.dataTransfer.files;

        if (files.length > 1) {
            alert('하나만 올리세요.');
            return;
        }

        if (files[0].type.match(/image.*/)) {
            $('#first_modal').css({
                display: 'none',
            });
            $('#second_modal').css({
                display: 'flex',
            });

            $('.img_upload_space').css({
                "background-image": "url(" + window.URL.createObjectURL(files[0]) + ")",
                "outline": "none",
                "background-size": "100%",
                "background-repeat": "no-repeat",
                "background-position": "center",
                "padding": "auto, 0",
                "align-items": "center"

            });
        } else {
            alert('이미지가 아닙니다.');
            return;
        }

    }
</script>
{# 모달 창 만들기 끝#}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
        crossorigin="anonymous"></script>
</body>
</html>